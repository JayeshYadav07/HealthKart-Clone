<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link rel="stylesheet" href="../style.css" />
        <link
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css"
            rel="stylesheet"
        />
        <style>
            * {
                line-height: 25px;
                font-family: sans-serif;
            }
            #productContainer {
                width: 85%;
                margin: auto;
            }
            #productContainer > h1 {
                margin-top: 20px;
                font-size: 24px;
                font-weight: 600;
                text-align: left;
                margin-left: 0;
            }
            #singleLineFilter {
                width: 100%;
                padding: 10px 20px;
                display: flex;
                align-items: center;
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                border: 1px solid #e9e9e9;
                border-radius: 5px;
                background: #fff;
                margin: 20px 0;
                font-weight: 600;
                color: #1c1c28;
            }
            #priceTitle {
                margin-right: 50px;
                font-weight: 600;
            }
            #singleLineFilter span {
                margin: 0 20px 0 5px;
                font-weight: 500;
            }
            #singleLineFilter input {
                height: 16px;
                width: 16px;
                cursor: pointer;
                opacity: 1;
            }
            #productFlexBox {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 30px;
                line-height: 21px;
                padding: 20px 0 50px 0;
            }
            #productFlexBox > .card {
                width: 23%;
                border-radius: 10px;
                overflow: hidden;
                border: 1px solid rgb(239, 236, 236);
            }
            #disclaimer {
                width: 90%;
                margin: 20px auto;
                text-align: justify;
                font-size: 12px;
                line-height: 21px;
                color: #212121;
            }
            #disclaimer span {
                font-weight: bold;
            }
            #productContainer button {
                padding: 7px 10px;
                background-color: white;
                cursor: pointer;
                color: #5e5e69;
                border: 1px solid #aeaeb5;
                border-radius: 2px;
            }
            #productContainer #loadBtn {
                display: flex;
                justify-content: center;
            }
            #filterBtn {
                padding: 10px 20px;
                font-size: 18px;
                font-weight: bold;
                border-radius: 4px;
                margin-left: auto;
                color: rgb(0, 154, 174) !important;
            }
            #filterBtn:hover {
                color: rgb(0, 216, 244) !important;
                border: 1px solid rgb(239, 230, 230);
            }
        </style>
    </head>
    <body>
        <div id="container">
            <header>
                <div id="logo_container">
                    <a href="../index.html"
                        ><img src="../images/logo.png" width="230px" alt="logo"
                    /></a>
                </div>
                <div id="search_bar">
                    <img
                        src="../images//searchIcon.png"
                        width="25px"
                        alt="searchIcon"
                    />
                    <input
                        type="text"
                        name="search"
                        id="search"
                        placeholder="Search Products..."
                    />
                </div>
                <div id="login_container">
                    <button onclick="showLogin()">Login</button>
                </div>
                <div id="cart_container">
                    <a href="cart.html"
                        ><img
                            src="../images/cart.png"
                            width="35px"
                            alt="cart-icon"
                    /></a>
                    <span id="cart_count" style="line-height: 16px">0</span>
                </div>
            </header>
            <hr />
            <section id="productContainer">
                <h1>Super Saving Sale</h1>
                <div id="singleLineFilter">
                    <h3 id="priceTitle">Price Sort</h3>
                    <tr>
                        <td>
                            <input
                                type="checkbox"
                                id="check1"
                                name="pl"
                                onchange="sortLowToHigh(this)"
                            />
                            <span>Low to High</span>
                        </td>
                        <td>
                            <input
                                type="checkbox"
                                id="check1"
                                name="pl"
                                onchange="sortHighToLow(this)"
                            />
                            <span>High to Low</span>
                        </td>
                    </tr>
                </div>
                <div id="productFlexBox"></div>
                <div id="loadBtn">
                    <button onclick="loadMore()">Load More Products</button>
                </div>
            </section>
            <div id="disclaimer">
                <span>Disclaimer:</span> Information and statements regarding
                the product/services have not been evaluated by the Food and
                Drug Administration or any government authority and not intended
                to diagnose, treat, cure, or prevent any disease.
                Product/Services reviews are provided by users based on their
                personal experiences & opinions, and do not reflect the opinion
                of HealthKart. Product/Services information provided by the
                seller on HealthKart is not exhaustive, please read the label on
                the product carefully for complete information provided by the
                manufacturer. The results from the products will vary from
                person to person. No individual result should be seen as
                typical.
            </div>
            <hr />
            <footer>
                <div class="enter-email" style="padding: 0 20px">
                    <span>Get Email Updates:</span>
                    <input
                        type="email"
                        id="email"
                        placeholder="Enter Email Address"
                    />
                    <button>Sign Up</button>
                </div>
                <div>
                    <div id="footer-body">
                        <div id="footer-details">
                            <ul>
                                <h4>Customer Service</h4>
                                <li>Contact Us</li>
                                <li>Order Status</li>
                                <li>Shipping</li>
                                <li>Return Policy & Exchanges</li>
                                <li>Price Adjustments</li>
                                <li>Gift Cards</li>
                                <li>Gift Cards</li>
                                <li>Product Recalls</li>
                                <li>India</li>
                            </ul>
                            <ul>
                                <h4>About Us</h4>
                                <li>All Brands</li>
                                <li>Careers</li>
                                <li>Corporate Social Responsibility</li>
                                <li>Diversity, Inclusion & Belonging</li>
                                <li>Get Email Updates</li>
                                <li>FitnessBazzar Blog</li>
                                <li>The Thread</li>
                                <li>Fitness Podcast</li>
                            </ul>
                            <ul>
                                <h4>Stores & Services</h4>
                                <li>Find a Store</li>
                                <li>Free Style Help</li>
                                <li>Alterations & Tailoring</li>
                                <li>Pop-In Shop</li>
                                <li>Virtual Events</li>
                                <li>Spa FitnessBazzar</li>
                                <li>FitnessBazzar Restaurants</li>
                                <li>FitnessBazzar Local</li>
                            </ul>
                            <ul>
                                <h4>FitnessBazzar Card & Rewards</h4>
                                <li>The Fitness Club Rewards</li>
                                <li>Pay My Bill</li>
                                <li>Manage My Fitness Card</li>
                            </ul>
                            <ul>
                                <h4>FitnessBazzar, Inc.</h4>
                                <li>FitnessBazzar Rack</li>
                                <li>FitnessBazzar Canada</li>
                                <li>Investor Relations</li>
                                <li>Press Releases</li>
                                <li>FitnessBazzar Media Network</li>
                            </ul>
                        </div>
                        <div id="footer-links">
                            <h3>Socail Links</h3>
                            <div id="footer-social">
                                <img
                                    src="https://cdn-icons-png.flaticon.com/128/6433/6433685.png"
                                    alt=""
                                />
                                <img
                                    src="https://cdn-icons-png.flaticon.com/128/665/665213.png"
                                    alt=""
                                />
                                <img
                                    src="https://cdn-icons-png.flaticon.com/128/665/665228.png"
                                    alt=""
                                />
                                <img
                                    src="https://cdn-icons-png.flaticon.com/128/665/665209.png"
                                    alt=""
                                />
                                <img
                                    src="https://cdn-icons-png.flaticon.com/128/3018/3018447.png"
                                    alt=""
                                />
                            </div>
                        </div>
                        <div id="top" onclick="scrollFunction1()">
                            <img src="../images/top.png" alt="" />
                            <p>Top</p>
                        </div>
                    </div>
                    <div id="footer-policy">
                        <ul>
                            <li>Privacy</li>
                            <li>Do Not Sell My Personal Information</li>
                            <li>Terms & Conditions</li>
                            <li>Interest-Based Ads</li>
                            <li>©2023 FitnessBazzar, Inc.</li>
                        </ul>
                    </div>
                </div>
            </footer>
            <div class="wrapper-container">
                <div class="wrapper">
                    <img
                        src="https://static1.hkrtcdn.com/hknext/static/media/common/login/close.svg"
                        alt=""
                        onclick="hideLogin()"
                    />
                    <div class="title-text">
                        <div class="title login">Login Form</div>
                        <div class="title signup">Signup Form</div>
                    </div>
                    <div class="form-container">
                        <div class="slide-controls">
                            <input
                                type="radio"
                                name="slide"
                                id="login"
                                checked
                            />
                            <input type="radio" name="slide" id="signup" />
                            <label for="login" class="slide login">Login</label>
                            <label for="signup" class="slide signup"
                                >Signup</label
                            >
                            <div class="slider-tab"></div>
                        </div>
                        <div class="form-inner">
                            <form action="#" class="login">
                                <div class="field">
                                    <input
                                        type="text"
                                        placeholder="Email Address"
                                        required
                                    />
                                </div>
                                <div class="field">
                                    <input
                                        type="password"
                                        placeholder="Password"
                                        required
                                    />
                                </div>
                                <div class="pass-link">
                                    <a href="#">Forgot password?</a>
                                </div>
                                <button
                                    class="field btn"
                                    id="loginBtn"
                                    onclick="loginUser(event)"
                                >
                                    Submit
                                </button>
                                <div class="signup-link">
                                    Not a member? <a href="">Signup now</a>
                                </div>
                            </form>
                            <form action="#" class="signup">
                                <div class="field">
                                    <input
                                        type="text"
                                        placeholder="Name"
                                        required
                                    />
                                </div>
                                <div class="field">
                                    <input
                                        type="text"
                                        placeholder="Email Address"
                                        required
                                    />
                                </div>
                                <div class="field">
                                    <input
                                        type="password"
                                        placeholder="password"
                                        required
                                    />
                                </div>
                                <button
                                    class="field btn"
                                    id="signupBtn"
                                    onclick="signupUser(event)"
                                >
                                    Submit
                                </button>
                                <p
                                    id="signUpMsg"
                                    style="
                                        margin: 10px 0px;
                                        color: red;
                                        font-size: 12px;
                                        text-align: center;
                                    "
                                ></p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
<script>
    const loginText = document.querySelector(".title-text .login");
    const loginForm = document.querySelector("form.login");
    const loginBtn = document.querySelector("label.login");
    const signupBtn = document.querySelector("label.signup");
    const signupLink = document.querySelector("form .signup-link a");
    let toastMixin = Swal.mixin({
        toast: true,
        icon: "success",
        title: "General Title",
        position: "top-right",
        showConfirmButton: false,
        timer: 2000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
        },
    });

    function showCartCount() {
        let cart_count = document.getElementById("cart_count");
        cart_count.innerText =
            JSON.parse(localStorage.getItem("cart")).length || 0;
    }
    signupBtn.onclick = () => {
        loginForm.style.marginLeft = "-50%";
        loginText.style.marginLeft = "-50%";
    };
    loginBtn.onclick = () => {
        loginForm.style.marginLeft = "0%";
        loginText.style.marginLeft = "0%";
    };
    signupLink.onclick = () => {
        signupBtn.click();
        return false;
    };
    if (localStorage.getItem("token") != null) {
        let loginBtn = document.querySelector("#login_container > button");
        loginBtn.innerText = "Logout";
        loginBtn.setAttribute("onclick", "logoutUser()");
        showCartCount();
    }

    function showLogin() {
        let wrapper = document.querySelector(".wrapper-container");
        wrapper.style.display = "flex";
    }

    function hideLogin() {
        let wrapper = document.querySelector(".wrapper-container");
        wrapper.style.display = "none";
    }

    // signup working fine

    function signupUser(e) {
        e.preventDefault();
        let obj = document.querySelectorAll(".signup input");
        const payload = {
            name: obj[0].value,
            email: obj[1].value,
            password: obj[2].value,
        };
        if (payload.name && payload.email && payload.password) {
            fetch("https://wild-gold-calf-robe.cyclic.app/users/register", {
                method: "POST",
                headers: {
                    "Content-type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((res) => res.json())
                .then((res) => {
                    toastMixin.fire({
                        animation: true,
                        title: res.msg,
                    });
                    obj[0].value = "";
                    obj[1].value = "";
                    obj[2].value = "";
                    hideLogin();
                })
                .catch((err) => alert("Something went wrong"));
        }
    }
    //login is also working fine but check once for setCart Count
    function loginUser(e) {
        e.preventDefault();
        let obj = document.querySelectorAll(".login input");
        console.log(obj);
        const payload = {
            email: obj[0].value,
            password: obj[1].value,
        };
        if (payload.email !== "" && payload.password !== "") {
            fetch("https://wild-gold-calf-robe.cyclic.app/users/login", {
                method: "POST",
                headers: {
                    "Content-type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((res) => res.json())
                .then((res) => {
                    if (res.msg === "User Successfully logged in") {
                        localStorage.setItem("token", res.token);
                        let loginBtn = document.querySelector(
                            "#login_container > button"
                        );
                        loginBtn.innerText = "Logout";
                        loginBtn.setAttribute("onclick", "logoutUser()");
                        obj[0].value = "";
                        obj[1].value = "";
                        toastMixin.fire({
                            animation: true,
                            title: res.msg,
                        });
                        localStorage.setItem(
                            "cart",
                            JSON.stringify(res.user.carts)
                        );
                        showCartCount();
                        hideLogin();
                    } else {
                        toastMixin.fire({
                            icon: "error",
                            animation: true,
                            title: "Wrong Credentials",
                        });
                    }
                });
        }
    }

    function logoutUser() {
        toastMixin.fire({
            animation: true,
            title: "User logged out!",
        });
        localStorage.removeItem("token");
        let loginBtn = document.querySelector("#login_container > button");
        loginBtn.innerText = "Login";
        loginBtn.setAttribute("onclick", "showLogin()");
        let cart_count = document.getElementById("cart_count");
        cart_count.innerText = 0;
    }

    //add to cart done
    function addToCart(e) {
        const productId = e.getAttribute("data-id");
        fetch(
            `https://wild-gold-calf-robe.cyclic.app/users/addToCart?productId=${productId}`,
            {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: localStorage.getItem("token"),
                },
            }
        )
            .then((response) => response.json())
            .then((response) => {
                if (response.msg === "Login First!") {
                    toastMixin.fire({
                        title: response.msg,
                        icon: "error",
                    });
                } else if (response.msg === "Product Already in cart!") {
                    Swal.fire({
                        toast: true,
                        icon: "warning",
                        title: response.msg,

                        position: "bottom",
                        showConfirmButton: false,
                        timer: 2000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener(
                                "mouseenter",
                                Swal.stopTimer
                            );
                            toast.addEventListener(
                                "mouseleave",
                                Swal.resumeTimer
                            );
                        },
                    });
                } else {
                    Swal.fire({
                        toast: true,
                        icon: "success",
                        title: response.msg,

                        position: "bottom",
                        showConfirmButton: false,
                        timer: 2000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener(
                                "mouseenter",
                                Swal.stopTimer
                            );
                            toast.addEventListener(
                                "mouseleave",
                                Swal.resumeTimer
                            );
                        },
                    });
                    localStorage.setItem(
                        "cart",
                        JSON.stringify(response.user.carts)
                    );
                    showCartCount();
                }
            })
            .catch((error) => alert("Login First!"));
    }

    function scrollFunction1() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }
    let count = 8;
    async function sortLowToHigh(e) {
        if (e.checked) {
            let productFlexBox = document.querySelector("#productFlexBox");
            let arr = [];
            await fetch(
                `https://wild-gold-calf-robe.cyclic.app/products/getLowToHigh/${count}`,
                {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                }
            )
                .then((response) => response.json())
                .then((data) => (arr = data));
            productFlexBox.innerHTML = "";
            arr.forEach((element) => {
                element.name = element.name.substring(0, 60);
                productFlexBox.innerHTML =
                    productFlexBox.innerHTML + createCard(element);
            });
        } else {
            let productFlexBox = document.querySelector("#productFlexBox");
            let arr = [];
            await fetch(
                `https://wild-gold-calf-robe.cyclic.app/products/get/${count}`,
                {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                }
            )
                .then((response) => response.json())
                .then((data) => (arr = data));
            productFlexBox.innerHTML = "";
            arr.forEach((element) => {
                element.name = element.name.substring(0, 60);
                productFlexBox.innerHTML =
                    productFlexBox.innerHTML + createCard(element);
            });
        }
    }
    async function sortHighToLow(e) {
        if (e.checked) {
            let productFlexBox = document.querySelector("#productFlexBox");
            let arr = [];
            await fetch(
                `https://wild-gold-calf-robe.cyclic.app/products/getHighToLow/${count}`,
                {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                }
            )
                .then((response) => response.json())
                .then((data) => (arr = data));
            productFlexBox.innerHTML = "";
            arr.forEach((element) => {
                element.name = element.name.substring(0, 60);
                productFlexBox.innerHTML =
                    productFlexBox.innerHTML + createCard(element);
            });
        } else {
            let productFlexBox = document.querySelector("#productFlexBox");
            let arr = [];
            await fetch(
                `https://wild-gold-calf-robe.cyclic.app/products/get/${count}`,
                {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                }
            )
                .then((response) => response.json())
                .then((data) => (arr = data));
            productFlexBox.innerHTML = "";
            arr.forEach((element) => {
                element.name = element.name.substring(0, 60);
                productFlexBox.innerHTML =
                    productFlexBox.innerHTML + createCard(element);
            });
        }
    }

    function createCard(obj) {
        return `
    <div class="card">
        <div class="cardImgContainer">
            <img src="${obj.image}" alt="" />
        </div>
        <div class="cardInfoContainer">
            <div class="ratingContainer">
                <span class="rating">${obj.rating} <img src="../images/rating.png" alt="" /> </span>
                <span class="cardReviews">${obj.reviews} reviews</span>
            </div>
            <p class="title">${obj.name}</p>
            <div class="priceContainer">
                <span>₹${obj.discountedPrice}</span>
                <span>₹${obj.price}</span>
                <span>${obj.discount}% off</span>
            </div>
            <div class="premiumContainer">
                <img src="../images/star.png" width="18px" alt="" />
                    <span>₹${obj.premiumPrice}</span>
                <span>for Premium Member</span>
            </div>
            <div class="addToCartBtnContainer" data-id="${obj._id}" onClick="addToCart(this)">
                <span>Add To Cart</span>
            </div>
        </div>
    </div>
    `;
    }
    showProducts(count);
    async function showProducts(count) {
        let productFlexBox = document.querySelector("#productFlexBox");
        let arr = [];
        await fetch(
            `https://wild-gold-calf-robe.cyclic.app/products/get/${count}`,
            {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            }
        )
            .then((response) => response.json())
            .then((data) => (arr = data));
        productFlexBox.innerHTML = "";
        arr.forEach((element) => {
            element.name = element.name.substring(0, 60);
            productFlexBox.innerHTML =
                productFlexBox.innerHTML + createCard(element);
        });
    }
    function loadMore() {
        count = count + 8;
        showProducts(count);
    }
</script>
